import{a8 as k,cB as ve,f as Q,a9 as Ee,a4 as G,b as g,u as T,d as le,dl as Be,aa as Re,a as Fe,cp as Oe,cq as Ve,dk as ue,r as u,J as N,a3 as Me,s as h,cE as J,c as z,aj as fe,aJ as me,dz as xe,dA as We,j as e,dB as L,dC as he,dD as pe,B as D,aw as U,a2 as W,I as $e,d4 as ze,dE as Ue,aq as $,G as V,ao as M,ar as Ke,dF as Y,dG as we,ae as Pe,ax as qe,cz as He,b8 as ge,L as Qe,ak as B,S as Ge,dH as Je,dI as Ye,dJ as Xe,dK as Ze,dL as Ie,dM as et,cA as tt,dN as ae,H as st,bO as nt}from"./index-z3CvngUh.js";import{A as X,L as at}from"./ActivityDetailsLayout-8lp4KXH7.js";import{E as ot,b as rt,d as it,f as dt,g as ct}from"./jettonService-hyWKbxlO.js";import{u as lt}from"./RecipientView-SdaMDAg5.js";import{C as Z,a as je,e as ke,f as be,g as _e,h as Ae,c as I,d as ee}from"./ConfirmView-ihgnCI_i.js";import{u as Ce,t as ut,a as ft,I as mt}from"./Nfts-2YYDcbAs.js";import"./UserCancelledError-WQqxL8x6.js";import"./NftHeader-uTS0xySw.js";function oe(t){return!!t.dns}function te(t){var n;const s=k();return t.sale!==void 0||!ve(s.active.rawAddress,(n=t.owner)==null?void 0:n.address)}function ye({caller:t,queryKey:s,options:n},o){const{api:a}=Q(),r=k();return Ee(s,async()=>{const i=await t({...o,walletState:r,api:a}),d=await new ot(a.tonApiV2).emulateMessageToAccountEvent({ignoreSignatureCheck:!0,accountId:r.active.rawAddress,decodeMessageRequest:{boc:i}});return{fee:new X({asset:G,weiAmount:d.extra*-1}),payload:{event:d}}},n)}const Se=t=>ye({caller:rt,queryKey:["estimate-link-nft",t.nftAddress,t.linkToAddress]},t);function Ne({executor:t,eventName2:s},n){const{t:o}=g(),a=T(),{api:r}=Q(),i=k(),d=le(),l=Be(),{mutateAsync:f}=Re();return Fe(async()=>{if(!n.fee)return!1;const c=await Oe(a,i.publicKey,f).catch(()=>null);if((c==null?void 0:c.type)!=="cell")throw new Ve(o("ledger_operation_not_supported"));if(c===null)return!1;l(s);try{await t({api:r,walletState:i,signer:c,...n})}catch(m){await ue(d,a,o,m)}return await d.invalidateQueries([i.active.rawAddress]),await d.invalidateQueries(),!0})}const Le=t=>Ne({executor:it,eventName2:"link-dns"},t);function se(t){const s=k(),n=u.useRef(!0),{isLoading:o,data:a,mutate:r}=lt();return u.useEffect(()=>{n.current=!1,r({address:t})},[t]),{recipient:u.useMemo(()=>({address:{address:N(t,s.network,!0),blockchain:Me.TON},comment:"",done:!1,toAccount:a}),[a]),isLoading:n.current?!0:o}}function ne(){const{t}=g(),s=T(),n=le();return o=>ue(n,s,t,o)}function Te(t,s){const[n,o]=u.useState(!1),[a,r]=u.useState(!1),[i,d]=u.useState(!1),l=u.useRef(t.data),f=async()=>{const c=await t.refetch();if(i&&o(!1),s(c.data,l.current)){o(!1),r(!0);return}l.current=c.data,setTimeout(f,1e3)};return u.useEffect(()=>()=>d(!0),[]),{isLoading:n,isCompleted:a,data:t.data,refetch:(c=1e4)=>{l.current=t.data,o(!0),d(!1),r(!1),setTimeout(()=>{n&&d(!0)},c),f()}}}const re=({nft:t})=>{var c;const s=xe(),{t:n}=g(),o=We(t),{data:a,isLoading:r}=o,i=((c=a==null?void 0:a.wallet)==null?void 0:c.address)||"",{refetch:d,isLoading:l,isCompleted:f}=Te(o,(m,x)=>{var p,w;return!!((p=x==null?void 0:x.wallet)!=null&&p.address)!=!!((w=m==null?void 0:m.wallet)!=null&&w.address)});return u.useEffect(()=>{f&&s(n(i?"dns_address_linked":"dns_address_unlinked"))},[f,i]),i?e.jsx(kt,{nft:t,linkedAddress:i,isLoading:l,refetch:d}):e.jsx(ht,{nft:t,isLoading:r||l,refetch:d})},xt=h(z)`
    cursor: pointer;
    color: ${t=>t.isDisabled?t.theme.textSecondary:t.theme.textAccent};
    pointer-events: ${t=>t.isDisabled?"none":"unset"};
`,R=new J(.02),De=X.fromRelativeAmount({asset:G,amount:R}),ht=({nft:t,isLoading:s,refetch:n})=>{var C;const o=ne(),{t:a}=g(),[r,i]=u.useState(),d=k(),[l,f]=u.useState(d.active.rawAddress),c=y=>{if(r==="wallet")return i("confirm");i(void 0),y?n():f(d.active.rawAddress)},{recipient:m,isLoading:x}=se(t.address),{refetch:p,...w}=Se({nftAddress:t.address,amount:L(R),linkToAddress:l}),b=u.useCallback(async y=>{f(y),await p(),i("confirm")},[p,t.address]),_=Le({nftAddress:t.address,amount:L(R),linkToAddress:l,fee:(C=w.data)==null?void 0:C.payload}),v=he(l,d.active.rawAddress),E=()=>e.jsxs(Z,{onClose:c,recipient:m,assetAmount:De,fitContent:!0,estimation:w,..._,children:[e.jsx(je,{}),e.jsx(ke,{}),e.jsxs(be,{children:[e.jsx(V,{hover:!1,children:e.jsxs(M,{children:[e.jsx(at,{children:a(v?"dns_current_address":"wallet_address")}),e.jsx(Ke,{right:!0,text:$(N(l,d.network)),secondary:e.jsx(xt,{isDisabled:_.isLoading,onClick:()=>i("wallet"),children:a("replace")})})]})}),e.jsx(_e,{}),e.jsx(Ae,{})]}),e.jsx(I,{children:e.jsx(ee,{MainButton:Y})})]}),j=u.useCallback(()=>e.jsx(gt,{onSave:b,isLoading:w.isFetching,domain:t.dns}),[b,w.isFetching]),A=te(t),K=()=>{if(w.error){o(w.error);return}i("confirm")},P=pe(t.dns);return e.jsxs(e.Fragment,{children:[e.jsx(D,{type:"button",size:"large",secondary:!0,fullWidth:!0,disabled:A,loading:w.isFetching||x||s,onClick:K,children:a(P?"nft_link_username_button":"nft_link_domain_button")}),e.jsx(U,{title:a(r==="wallet"?"wallet_address":"send_screen_steps_comfirm_title"),isOpen:!!r,hideButton:!0,handleClose:()=>c(),backShadow:!0,children:r==="wallet"?j:E})]})},pt=h(fe)`
    color: ${t=>t.theme.textSecondary};
    margin-bottom: 1.5rem;
`,wt=h(me)`
    align-items: flex-start;
`,gt=({onSave:t,isLoading:s,domain:n})=>{const{t:o}=g(),[a,r]=u.useState(""),[i,d]=u.useState(!1),l=u.useMemo(()=>{if(!i)return!0;try{return W.Address.parse(a),!0}catch{return!1}},[i,a]),f=c=>{c.stopPropagation(),c.preventDefault(),d(!0);try{t(W.Address.parse(a).toRawString())}catch(m){console.error(m)}};return e.jsxs(wt,{onSubmit:f,children:[e.jsx(pt,{children:o("add_dns_address").replace("%1%",n)}),e.jsx($e,{disabled:s,isValid:l,value:a,onChange:r,label:o("wallet_address"),clearButton:!0}),e.jsx(ze,{}),e.jsx(D,{fullWidth:!0,size:"large",primary:!0,disabled:!a,loading:s,children:"Save"})]})},jt=h(z)`
    text-align: center;
    color: ${t=>t.theme.accentOrange};
`,ie="",kt=({nft:t,linkedAddress:s,isLoading:n,refetch:o})=>{var j;const a=ne(),{t:r}=g(),i=k(),[d,l]=u.useState(!1),f=A=>{l(!1),A&&o()},{recipient:c,isLoading:m}=se(t.address),x=Se({nftAddress:t.address,amount:L(R),linkToAddress:ie}),p=Le({nftAddress:t.address,amount:L(R),linkToAddress:ie,fee:(j=x.data)==null?void 0:j.payload}),w=()=>e.jsxs(Z,{onClose:f,recipient:c,assetAmount:De,fitContent:!0,estimation:x,...p,children:[e.jsx(je,{}),e.jsx(ke,{}),e.jsxs(be,{children:[e.jsx(_e,{}),e.jsx(Ae,{})]}),e.jsx(I,{children:e.jsx(ee,{MainButton:Y})})]}),b=te(t),_=pe(t.dns),v=()=>{if(x.error){a(x.error);return}l(!0)},E=Object.values(Ue(i.publicKey,i.network)).every(A=>!he(A.rawAddress,s));return e.jsxs(e.Fragment,{children:[e.jsx(D,{type:"button",size:"large",secondary:!0,fullWidth:!0,disabled:b,loading:x.isFetching||m||n,onClick:v,children:r("nft_unlink_domain_button").replace("{{address}}",$(N(s,i.network)))}),E&&!n&&e.jsx(jt,{children:r(_?"tme_linked_with_another_address_warn":"dns_linked_with_another_address_warn")}),e.jsx(U,{title:r("confirm_unlink"),isOpen:d,hideButton:!0,handleClose:()=>f(),backShadow:!0,children:w})]})},bt=t=>ye({caller:dt,queryKey:["estimate-nft-renew",t.nftAddress]},t),_t=t=>Ne({executor:ct,eventName2:"renew-dns"},t),At=h.div`
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
`,Ct=h(D)`
    margin-bottom: 0.75rem;
`,yt=h(z)`
    color: ${t=>t.danger?t.theme.accentRed:t.theme.textSecondary};
`,de=new J(.02),St=X.fromRelativeAmount({asset:G,amount:new J(.02)}),Nt=1e3*60*60*24*366,Lt={year:"numeric",hour:void 0,minute:void 0},Tt=({nft:t})=>{var y;const s=xe(),n=te(t),o=ne(),{t:a,i18n:{language:r}}=g(),i=new Intl.RelativeTimeFormat(Pe(r),{style:"long"}),d=we(t),{data:l,isLoading:f}=d,{refetch:c,isLoading:m,isCompleted:x}=Te(d,(S,q)=>!!(S!=null&&S.getTime())&&S.getTime()!==(q==null?void 0:q.getTime()));u.useEffect(()=>{x&&s(a("renew_nft_renewed"))},[x]);const p=Ce(Date.now()+Nt,Lt),[w,b]=u.useState(!1),_=S=>{b(!1),S&&c()},{recipient:v,isLoading:E}=se(t.address),j=bt({nftAddress:t.address,amount:L(de)}),A=_t({nftAddress:t.address,amount:L(de),fee:(y=j.data)==null?void 0:y.payload}),K=()=>{if(j.error){o(j.error);return}b(!0)};if(!f&&!l)return null;const P=()=>e.jsx(Z,{onClose:_,recipient:v,assetAmount:St,fitContent:!0,estimation:j,...A,children:e.jsx(I,{children:e.jsx(ee,{MainButton:Y})})}),C=ut(l);return e.jsxs(e.Fragment,{children:[e.jsxs(At,{children:[e.jsx(Ct,{type:"button",disabled:n||m,loading:f||j.isFetching||E,onClick:K,size:"large",secondary:!0,fullWidth:!0,children:m?a("renew_nft_in_progress"):a("dns_renew_until_btn").replace("%{untilDate}",p)}),C!==""&&e.jsx(yt,{danger:Number(C)<=30,children:a("renew_nft_expiration_date").replace("%1%",i.format(Number(C),"days"))})]}),e.jsx(U,{isOpen:w,hideButton:!0,handleClose:()=>_,backShadow:!0,children:P})]})},Dt=t=>{const{marketplace:s}=t.metadata,n=W.Address.parse(t.address).toString();switch(s){case"getgems.io":return`https://getgems.io/nft/${n}`;default:return`https://getgems.io/nft/${n}`}},F=({url:t})=>{const{t:s}=g(),n=T();return e.jsx(D,{size:"large",secondary:!0,fullWidth:!0,onClick:o=>{o.preventDefault(),o.stopPropagation(),n.openPage(t)},children:s("nft_open_in_marketplace")})},O=({nftItem:t})=>{var a;const s=T(),{t:n}=g(),o=k();return e.jsxs(e.Fragment,{children:[e.jsx(D,{primary:!0,size:"large",fullWidth:!0,disabled:t.sale!==void 0||((a=t.owner)==null?void 0:a.address)!==o.active.rawAddress,onClick:r=>{r.preventDefault(),r.stopPropagation(),s.uiEvents.emit("transferNft",{method:"transferNft",params:t})},children:n("nft_transfer_nft")}),t.sale&&e.jsx(Et,{children:n("nft_on_sale_text")})]})},vt=h(z)`
    width: 100%;
    color: ${t=>t.theme.textSecondary};
`,Et=h(vt)`
    width: 100%;
    padding: 0 1rem;
    text-align: left;
`,Bt=({kind:t,nftItem:s})=>{var n,o;switch(t){case"token":return e.jsxs(e.Fragment,{children:[e.jsx(O,{nftItem:s}),e.jsx(F,{url:Dt(s)})]});case"ton.dns":return e.jsxs(e.Fragment,{children:[e.jsx(O,{nftItem:s}),e.jsx(F,{url:`https://dns.ton.org/#${(n=s.dns)==null?void 0:n.slice(0,-4)}`}),oe(s)&&e.jsxs(e.Fragment,{children:[e.jsx(re,{nft:s}),e.jsx(Tt,{nft:s})]})]});case"telegram.number":{const a=s.metadata.name.replace(/\s/g,"").slice(1);return e.jsxs(e.Fragment,{children:[e.jsx(O,{nftItem:s}),e.jsx(F,{url:`https://fragment.com/number/${a}`})]})}case"telegram.name":return e.jsxs(e.Fragment,{children:[e.jsx(O,{nftItem:s}),e.jsx(F,{url:`https://fragment.com/username/${(o=s.dns)==null?void 0:o.slice(0,-5)}`}),oe(s)&&e.jsx(re,{nft:s})]})}},Rt=h.div`
    width: 100%;
`,Ft=h.div`
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.625rem;
`,Ot=h(B)`
    cursor: pointer;
    color: ${t=>t.theme.textAccent};
`,H=h(fe)`
    color: ${t=>t.theme.textSecondary};
`,Vt=qe.memo(({nftItem:t})=>{var w;const s=k(),{t:n}=g(),{data:o}=He(t.address),{data:a,isLoading:r}=we(t),i=Ce(a,{year:"numeric",hour:void 0,minute:void 0}),d=o??t,l=T(),{config:f}=Q(),c=(w=d.owner)==null?void 0:w.address,m=W.Address.parse(d.address).toString(),x=f.NFTOnExplorerUrl??"https://tonviewer.com/nft/%s",p=N(m,s.network,!0);return e.jsxs(Rt,{children:[e.jsxs(Ft,{children:[e.jsx(ge,{children:n("nft_details")}),e.jsx(Ot,{onClick:()=>l.openPage(x.replace("%s",m)),children:n("nft_view_in_explorer")})]}),e.jsxs(Qe,{margin:!1,children:[c&&e.jsx(V,{onClick:()=>l.copyToClipboard(N(c,s.network)),children:e.jsxs(M,{children:[e.jsx(H,{children:n("nft_owner_address")}),e.jsx(B,{children:$(N(c,s.network))})]})}),!!(a||r)&&e.jsx(V,{hover:!1,children:e.jsxs(M,{children:[e.jsx(H,{children:n("dns_expiration_date")}),a?e.jsx(B,{children:i}):e.jsx(Ge,{})]})}),e.jsx(V,{onClick:()=>l.copyToClipboard(p),children:e.jsxs(M,{children:[e.jsx(H,{children:n("nft_contract_address")}),e.jsx(B,{children:$(p)})]})})]})]})}),ce=h.div`
    display: flex;
    flex-direction: column;
    padding: 0.875rem 1rem;
`,Mt=h.div`
    border-top: 1px solid ${t=>t.theme.separatorCommon};
`,Wt=h(B)`
    margin-bottom: 0.5rem;
`,$t=h.span`
    position: relative;
    top: 3px;
    margin-left: 4px;
`,zt="0:b774d95eb20543f186c06b371ab88ad704f7e256130caf96189368a7d0cb6ccf",Ut="0:80d78a35f955a14b679faa887ff4cd5bfc0f43b4a4eea2a7e6927f3701b273c2",Kt="0:0e41dc1dc3c9067ed24248580e12b3359818d83dee0304fabcf80845eafafdb2",Pt=h(st)`
    word-break: break-word;

    user-select: none;
`,qt=h(nt)`
    color: ${t=>t.theme.textSecondary};
    border: 1px solid ${t=>t.theme.buttonTertiaryBackground};
    border-radius: 6px;
    padding: 3.5px 6px 4.5px;
    text-transform: uppercase;

    position: relative;
    top: -3px;

    white-space: nowrap;
`,Ht=({onClose:t,nftItem:s})=>{var c,m,x;const n=u.useRef(null),{t:o}=g(),{data:a}=Je(s),{description:r}=s.metadata,i=s.dns??s.metadata.name,d=u.useMemo(()=>{var p;switch((p=s.collection)==null?void 0:p.address){case zt:return"ton.dns";case Ut:return"telegram.name";case Kt:return"telegram.number";default:return"token"}},[s]),l=(c=s==null?void 0:s.collection)==null?void 0:c.name,f=(m=s.previews)==null?void 0:m.find(p=>p.resolution==="1500x1500");return e.jsxs(me,{children:[t&&e.jsxs(Ye,{children:[e.jsx(Xe,{onClick:t,children:e.jsx(Ze,{})}),e.jsx(ge,{children:s.dns??s.metadata.name}),e.jsx(Ie,{})]}),e.jsxs(ft,{children:[f&&e.jsx(mt,{ref:n,url:f.url}),e.jsxs(ce,{children:[e.jsxs(Pt,{children:[i,s.sale&&e.jsxs(e.Fragment,{children:["  ",e.jsx(qt,{children:o("nft_on_sale")})]})]}),l&&e.jsxs(et,{open:!0,margin:"small",children:[l,s.approvedBy&&s.approvedBy.length>0&&e.jsx($t,{children:e.jsx(tt,{})})]}),r&&e.jsx(ae,{text:r,margin:"last",contentColor:!0})]}),a&&((x=a.metadata)==null?void 0:x.description)&&e.jsxs(e.Fragment,{children:[e.jsx(Mt,{}),e.jsxs(ce,{children:[e.jsx(Wt,{children:o("nft_about_collection")}),e.jsx(ae,{text:a.metadata.description,margin:"last",contentColor:!0})]})]})]}),e.jsx(Bt,{nftItem:s,kind:d}),e.jsx(Vt,{nftItem:s,kind:d})]})},ts=()=>{const t=T(),[s,n]=u.useState(void 0),o=u.useCallback(()=>{n(void 0)},[n]);u.useEffect(()=>{const r=i=>{n(i.params)};return t.uiEvents.on("nft",r),()=>{t.uiEvents.off("nft",r)}},[t,n]);const a=u.useCallback(()=>{if(s)return e.jsx(Ht,{onClose:o,nftItem:s})},[s,o]);return e.jsx(U,{isOpen:s!==void 0,hideButton:!0,handleClose:o,backShadow:!0,children:a})};export{ts as default};
