import{c7 as F,c8 as M,c9 as $,ca as B,cb as H,cc as J,j as t,b as g,at as v,bR as f,au as u,bS as h,bP as A,L as d,a8 as L,r as j,aw as O,aq as S,G as Q,cd as E,ce as q,b6 as G,cf as U}from"./index-z3CvngUh.js";import{g as z,N as V,J as Y,a as K,S as X,b as Z,c as tt,U as et,C as st,d as nt,E as it,R as at,e as rt,W as ot,P as ct,A as ut,T as dt}from"./TonActivityEvents-fcdndn3P.js";import{E as m,a as y,T as p,b as x,c as k,F as D,d as lt,e as l,f as b,g as R,h as W,i as mt,j as P,k as xt,l as C,m as N,n as I,o as jt,p as _,q as ft,r as ht}from"./ActivityDetailsLayout-8lp4KXH7.js";class At extends F{constructor(n,s){super(n,s)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(n,s){super.setOptions({...n,behavior:M()},s)}getOptimisticResult(n){return n.behavior=M(),super.getOptimisticResult(n)}fetchNextPage({pageParam:n,...s}={}){return this.fetch({...s,meta:{fetchMore:{direction:"forward",pageParam:n}}})}fetchPreviousPage({pageParam:n,...s}={}){return this.fetch({...s,meta:{fetchMore:{direction:"backward",pageParam:n}}})}createResult(n,s){var i,a,r,o,c,T;const{state:w}=n;return{...super.createResult(n,s),fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:$(s,(i=w.data)==null?void 0:i.pages),hasPreviousPage:B(s,(a=w.data)==null?void 0:a.pages),isFetchingNextPage:w.fetchStatus==="fetching"&&((r=w.fetchMeta)==null||(o=r.fetchMore)==null?void 0:o.direction)==="forward",isFetchingPreviousPage:w.fetchStatus==="fetching"&&((c=w.fetchMeta)==null||(T=c.fetchMore)==null?void 0:T.direction)==="backward"}}}function Kt(e,n,s){const i=H(e,n,s);return J(i,At)}const gt=(e,n)=>{if(!e||!e.pages.length)return n;if(e.pageParams.length){const r=e.pageParams[e.pageParams.length-1];if(r===void 0||r===0)return n}const{events:s}=e.pages[e.pages.length-1];if(!s.length)return n;const a=s[s.length-1].timestamp*1e3;return{pageParams:n.pageParams,pages:n.pages.map(r=>({...r,events:r.events.filter(o=>o.timestamp>a)}))}},vt=(e,n)=>{const s=[];return e&&e.pages.forEach(i=>{const a=i.events.map(r=>({timestamp:r.timestamp*1e3,key:r.eventId,event:{kind:"ton",event:r}}));s.push(...a)}),n&&gt(e,n).pages.forEach(a=>{const r=a.events.map(o=>({timestamp:o.timestamp,key:`${o.txHash}-${o.actions.map(c=>c.type).join("-")}`,event:{kind:"tron",event:o}}));s.push(...r)}),s},yt=(e,n)=>z(vt(e,n)),pt=({tonTransfer:e,timestamp:n,event:s,isScam:i,status:a})=>{const r=L(),{data:o}=f(u.TON),{fiatAmount:c}=h(o,A(e.amount)),T=e.recipient.address===r.active.rawAddress?"received":"send";return t.jsxs(y,{event:s,children:[t.jsx(P,{isScam:i,amount:e.amount,symbol:u.TON,total:c,timestamp:n,kind:T,status:a}),t.jsxs(d,{margin:!1,fullWidth:!0,children:[T==="received"&&t.jsx(R,{sender:e.sender}),T==="send"&&t.jsx(W,{recipient:e.recipient}),t.jsx(l,{eventId:s.eventId}),t.jsx(b,{extra:s.extra}),t.jsx(xt,{comment:i?void 0:e.comment})]})]})},kt=({action:e,timestamp:n,event:s,isScam:i})=>{const{tonTransfer:a}=e;return a?t.jsx(pt,{tonTransfer:a,event:s,isScam:i,timestamp:n,status:e.status}):t.jsx(m,{event:s})},bt=({action:e,timestamp:n,event:s})=>{const{t:i}=g(),{auctionBid:a}=e,r=v(),{data:o}=f(u.TON),{fiatAmount:c}=h(o,A((a==null?void 0:a.amount.value)??0));return a?t.jsxs(y,{event:s,children:[t.jsxs("div",{children:[t.jsx(p,{children:i("transaction_type_bid")}),t.jsxs(x,{children:[r(a.amount.value)," ",a.amount.tokenName]}),c&&t.jsxs(x,{children:["≈ ",c]}),t.jsx(k,{kind:"send",timestamp:n}),t.jsx(D,{status:e.status})]}),t.jsxs(d,{margin:!1,fullWidth:!0,children:[t.jsx(lt,{beneficiary:a.auction}),t.jsx(l,{eventId:s.eventId}),t.jsx(b,{extra:s.extra})]})]}):t.jsx(m,{event:s})},Tt=({action:e,timestamp:n,event:s})=>{g();const{domainRenew:i,simplePreview:a}=e;return i?t.jsxs(y,{event:s,children:[t.jsxs("div",{children:[t.jsx(p,{children:i.domain}),t.jsx(k,{kind:"send",timestamp:n}),t.jsx(D,{status:e.status})]}),t.jsxs(d,{margin:!1,fullWidth:!0,children:[t.jsx(R,{sender:i.renewer,bounced:!0}),t.jsx(l,{eventId:s.eventId}),t.jsx(b,{extra:s.extra})]})]}):t.jsx(m,{event:s})},wt=({action:e,timestamp:n,event:s})=>{const{smartContractExec:i}=e,a=v(),{data:r}=f(u.TON),{fiatAmount:o}=h(r,A((i==null?void 0:i.tonAttached)??0));return i?t.jsxs(y,{event:s,children:[t.jsxs("div",{children:[t.jsxs(p,{children:["- ",a(i.tonAttached)," ",u.TON]}),o&&t.jsxs(x,{children:["≈ ",o]}),t.jsx(k,{kind:"call",timestamp:n}),t.jsx(D,{status:e.status})]}),t.jsxs(d,{margin:!1,fullWidth:!0,children:[t.jsx(W,{recipient:i.contract,bounced:!0}),t.jsx(l,{eventId:s.eventId}),t.jsx(b,{extra:s.extra}),t.jsx(mt,{operation:i.operation})]})]}):t.jsx(m,{event:s})},Dt=({depositStake:e,timestamp:n,event:s,status:i})=>{const{t:a}=g(),{data:r}=f(u.TON),o=v(),{fiatAmount:c}=h(r,A(e.amount));return t.jsxs(y,{event:s,children:[t.jsxs("div",{children:[t.jsx(p,{children:a("staking_deposit")}),t.jsxs(x,{children:["- ",o(e.amount)," ",u.TON]}),t.jsxs(x,{children:["≈ ",c]}),t.jsx(k,{kind:"send",timestamp:n}),t.jsx(D,{status:i})]}),t.jsxs(d,{margin:!1,fullWidth:!0,children:[t.jsx(C,{pool:e.pool}),t.jsx(l,{eventId:s.eventId}),t.jsx(b,{extra:s.extra})]})]})},Nt=({action:e,timestamp:n,event:s,isScam:i})=>{const{depositStake:a}=e;return a?t.jsx(Dt,{depositStake:a,timestamp:n,event:s,isScam:i,status:e.status}):t.jsx(m,{event:s})},St=({withdrawStake:e,timestamp:n,event:s,status:i})=>{const{t:a}=g(),{data:r}=f(u.TON),o=v(),{fiatAmount:c}=h(r,A(e.amount));return t.jsxs(y,{event:s,children:[t.jsxs("div",{children:[t.jsx(p,{children:a("staking_withdraw")}),t.jsxs(x,{children:["+ ",o(e.amount)," ",u.TON]}),t.jsxs(x,{children:["≈ ",c]}),t.jsx(k,{kind:"send",timestamp:n}),t.jsx(D,{status:i})]}),t.jsxs(d,{margin:!1,fullWidth:!0,children:[t.jsx(C,{pool:e.pool}),t.jsx(l,{eventId:s.eventId}),t.jsx(b,{extra:s.extra})]})]})},Pt=({action:e,timestamp:n,event:s,isScam:i})=>{const{withdrawStake:a}=e;return a?t.jsx(St,{withdrawStake:a,timestamp:n,event:s,isScam:i,status:e.status}):t.jsx(m,{event:s})},Ct=({withdrawStakeRequest:e,timestamp:n,event:s,status:i})=>{const{t:a}=g(),{data:r}=f(u.TON),o=v(),{fiatAmount:c}=h(r,A(e.amount??0));return t.jsxs(y,{event:s,children:[t.jsxs("div",{children:[t.jsx(p,{children:a("activityActionModal_withdrawal_request")}),e.amount&&t.jsxs(t.Fragment,{children:[t.jsxs(x,{children:["+ ",o(e.amount)," ",u.TON]}),t.jsxs(x,{children:["≈ ",c]})]}),t.jsx(k,{kind:"send",timestamp:n}),t.jsx(D,{status:i})]}),t.jsxs(d,{margin:!1,fullWidth:!0,children:[t.jsx(C,{pool:e.pool}),t.jsx(l,{eventId:s.eventId}),t.jsx(b,{extra:s.extra})]})]})},It=({action:e,timestamp:n,event:s,isScam:i})=>{const{withdrawStakeRequest:a}=e;return a?t.jsx(Ct,{withdrawStakeRequest:a,timestamp:n,event:s,isScam:i,status:e.status}):t.jsx(m,{event:s})},Mt=e=>{switch(e.action.type){case"TonTransfer":return t.jsx(kt,{...e});case"NftItemTransfer":return t.jsx(nt,{...e});case"ContractDeploy":return t.jsx(st,{...e});case"UnSubscribe":return t.jsx(et,{...e});case"Subscribe":return t.jsx(tt,{...e});case"AuctionBid":return t.jsx(bt,{...e});case"DomainRenew":return t.jsx(Tt,{...e});case"SmartContractExec":return t.jsx(wt,{...e});case"JettonTransfer":return t.jsx(Z,{...e});case"JettonSwap":return t.jsx(X,{...e});case"JettonMint":return t.jsx(K,{...e});case"JettonBurn":return t.jsx(Y,{...e});case"DepositStake":return t.jsx(Nt,{...e});case"WithdrawStake":return t.jsx(Pt,{...e});case"WithdrawStakeRequest":return t.jsx(It,{...e});case"NftPurchase":return t.jsx(V,{...e});case"Unknown":return t.jsx(m,{event:e.event});default:return console.log(e),t.jsx(m,{event:e.event,children:e.action.type})}},Ot=({value:e,handleClose:n})=>{const s=j.useCallback(()=>{if(e)return t.jsx(Mt,{isScam:e.isScam,action:e.action,timestamp:e.timestamp,event:e.event})},[e,n]);return t.jsx(O,{isOpen:!!e,handleClose:n,children:s})},Rt=({sendTRC20:e,timestamp:n,event:s})=>{const i=j.useMemo(()=>A(e.amount,e.token.decimals),[e]),{data:a}=f(e.token.symbol),{fiatAmount:r}=h(a,i);return t.jsxs(I,{event:s,children:[t.jsx(P,{amount:e.amount,decimals:e.token.decimals,symbol:e.token.symbol,total:r,timestamp:n,kind:"send"}),t.jsxs(d,{margin:!1,fullWidth:!0,children:[t.jsx(ft,{address:e.recipient}),t.jsx(l,{eventId:s.txHash}),s.fees&&t.jsx(_,{fees:s.fees})]})]})},Wt=({action:e,timestamp:n,event:s})=>{const{sendTRC20:i}=e;return i?t.jsx(Rt,{sendTRC20:i,event:s,timestamp:n}):t.jsx(N,{event:s})},_t=({receiveTRC20:e,timestamp:n,event:s})=>{const i=j.useMemo(()=>A(e.amount,e.token.decimals),[e]),{data:a}=f(e.token.symbol),{fiatAmount:r}=h(a,i);return t.jsxs(I,{event:s,children:[t.jsx(P,{amount:e.amount,decimals:e.token.decimals,symbol:e.token.symbol,total:r,timestamp:n,kind:"received"}),t.jsxs(d,{margin:!1,fullWidth:!0,children:[t.jsx(ht,{address:e.sender}),t.jsx(l,{eventId:s.txHash})]})]})},Ft=({action:e,timestamp:n,event:s})=>{const{receiveTRC20:i}=e;return i?t.jsx(_t,{receiveTRC20:i,event:s,timestamp:n}):t.jsx(N,{event:s})},$t=({action:e,timestamp:n,event:s})=>{const{t:i}=g(),{contractDeploy:a}=e;return a?t.jsxs(I,{event:s,children:[t.jsxs("div",{children:[t.jsx(p,{children:i("transaction_type_wallet_initialized")}),t.jsx(k,{kind:"send",timestamp:n})]}),t.jsxs(d,{margin:!1,fullWidth:!0,children:[t.jsx(jt,{address:a.ownerAddress}),t.jsx(l,{eventId:s.txHash}),s.fees&&t.jsx(_,{fees:s.fees})]})]}):t.jsx(N,{event:s})},Bt=e=>{switch(e.action.type){case"ReceiveTRC20":return t.jsx(Ft,{...e});case"SendTRC20":return t.jsx(Wt,{...e});case"ContractDeploy":return t.jsx($t,{...e});default:return console.log(e),t.jsx(N,{event:e.event,children:e.action.type})}},Ht=({value:e,handleClose:n})=>{const s=j.useCallback(()=>{if(e)return t.jsx(Bt,{action:e.action,timestamp:e.timestamp,event:e.event})},[e,n]);return t.jsx(O,{isOpen:!!e,handleClose:n,children:s})},Jt=({receiveTRC20:e,date:n})=>{const s=v();return t.jsx(at,{amount:s(e.amount,e.token.decimals),symbol:e.token.symbol,sender:S(e.sender),date:n})},Lt=({sendTRC20:e,date:n})=>{const s=v();return t.jsx(rt,{amount:s(e.amount,e.token.decimals),symbol:e.token.symbol,recipient:S(e.recipient),date:n})},Qt=({contractDeploy:e,date:n})=>t.jsx(ot,{address:S(e.ownerAddress),date:n}),Et=({action:e,date:n})=>{const{t:s}=g();return e.receiveTRC20?t.jsx(Jt,{receiveTRC20:e.receiveTRC20,date:n}):e.sendTRC20?t.jsx(Lt,{sendTRC20:e.sendTRC20,date:n}):e.contractDeploy?t.jsx(Qt,{contractDeploy:e.contractDeploy,date:n}):(console.log(e),t.jsx(it,{children:s("txActions_signRaw_types_unknownTransaction")}))},qt=({event:e,date:n,timestamp:s,setTronAction:i})=>t.jsx(t.Fragment,{children:e.actions.map((a,r)=>t.jsxs(Q,{onClick:()=>i({action:a,timestamp:s,event:e}),children:[t.jsx(Et,{action:a,date:n}),e.inProgress&&t.jsx(ct,{})]},r))}),Xt=({isFetched:e,isFetchingNextPage:n,tonEvents:s,tronEvents:i})=>{const a=j.useMemo(()=>yt(s,i),[s,i]);return e?t.jsxs(q,{children:[t.jsx(Gt,{items:a}),n&&t.jsx(G,{size:3})]}):t.jsx(E,{})},Gt=({items:e})=>{const[n,s]=j.useState(void 0),[i,a]=j.useState(void 0);return t.jsxs(t.Fragment,{children:[t.jsx(ut,{groups:e,RenderItem:({event:r,date:o,timestamp:c})=>r.kind==="tron"?t.jsx(qt,{event:r.event,date:o,timestamp:c,setTronAction:a}):r.kind==="ton"?t.jsx(dt,{event:r.event,date:o,timestamp:c,setActivity:s}):t.jsx(t.Fragment,{})}),t.jsx(Ot,{value:n,handleClose:()=>s(void 0)}),t.jsx(Ht,{value:i,handleClose:()=>a(void 0)})]})},Zt=(e,n,s,i,a)=>{j.useEffect(()=>{if(!e)return;const r=i?a==null?void 0:a.current:window;if(!r)return;const o=U(()=>{if(!n&&document.documentElement.className!=="is-locked")if(r===window)window.innerHeight+window.scrollY>=document.body.offsetHeight-500&&s();else{const c=r;c.scrollTop>=c.scrollHeight-window.innerHeight-500&&s()}},50);return r.addEventListener("scroll",o),o(),()=>{r.removeEventListener("scroll",o)}},[e,i,a])};export{Xt as A,Gt as M,Zt as a,yt as g,Kt as u};
