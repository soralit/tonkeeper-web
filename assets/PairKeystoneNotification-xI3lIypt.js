import{ew as f,a8 as x,b as k,f as S,r as n,j as a,aJ as y,B as C,u as K,aw as b}from"./index-z3CvngUh.js";import{K as j}from"./index-JmPMtE-O.js";import{u as v}from"./keystoneScanner-pVbdAmTL.js";import{u as E}from"./navigate-Kq_QSRRE.js";import{H as h,B as w,K as B}from"./AccountView-SLu2SoXs.js";import"./v4-OErdnafK.js";import"./TransitionGroup-vxI9EqGQ.js";const R=(s,t,i,e)=>new f.KeystoneSDK({origin:"TonKeeper"}).ton.generateSignRequest({signData:s.toString("hex"),dataType:t==="transaction"?1:2,address:i,xfp:e==null?void 0:e.mfp,derivationPath:e==null?void 0:e.path}),_=({sdk:s,transactionParams:t,onClose:i,handleResult:e})=>{const u=x(),{t:o}=k(),{extension:l}=S();E(s,i);const c=new j,p=n.useCallback(m=>{const g=c.ton.parseSignature(m);e(g.signature)},[]),r=v(null,p),d=n.useMemo(()=>R(t.message,t.messageType,u.active.friendlyAddress,t.pathInfo),[t]);return a.jsxs(y,{onSubmit:m=>{m.preventDefault(),m.stopPropagation(),r()},children:[a.jsx(h,{title:o("import_signer"),description:o("signer_scan_tx_description")}),a.jsx(w,{extension:l,margin:!0,children:a.jsx(B,{data:d})}),a.jsx(C,{primary:!0,size:"large",fullWidth:!0,type:"submit",children:o("signer_scan_result")})]})},W=()=>{const s=K(),[t,i]=n.useState(void 0),[e,u]=n.useState(void 0),o=n.useCallback(()=>{i(void 0),u(void 0)},[]),l=n.useCallback(r=>{console.log(r),s.uiEvents.emit("response",{method:"response",id:e,params:r}),o()},[s,e,o]),c=n.useCallback(()=>{e&&s.uiEvents.emit("response",{method:"response",id:e,params:new Error("Cancel auth request")}),o()},[e,s,o]);n.useEffect(()=>{const r=d=>{i(d.params),u(d.id)};return s.uiEvents.on("keystone",r),()=>{s.uiEvents.off("keystone",r)}},[s]);const p=n.useCallback(()=>{if(!(!t||!e))return a.jsx(_,{sdk:s,transactionParams:t,onClose:c,handleResult:l})},[s,t,e,c,l]);return a.jsx(b,{isOpen:t!=null&&e!=null,handleClose:c,children:p})};export{_ as SignerContent,W as default};
