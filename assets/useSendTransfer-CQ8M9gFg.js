import{a3 as S,di as q,c6 as v,a5 as C,b as T,u as y,f as m,a8 as p,d as h,b1 as k,d5 as N,a9 as Q,dj as x,dk as g,Q as K,a4 as A,dl as M,aa as O,a as R,cp as W}from"./index-z3CvngUh.js";import{A as l}from"./ActivityDetailsLayout-8lp4KXH7.js";import{e as B,s as D}from"./jettonService-hyWKbxlO.js";import{a as J,b as L}from"./tonService-784EZxnW.js";function E(s){return s.blockchain===S.TON}async function j({tronApi:s,tron:e,recipient:n,amount:a}){return new v(s).getEstimation({ownerAddress:e.ownerWalletAddress,getEstimationRequest:{lifeTime:Math.floor(Date.now()/1e3)+600,messages:[{to:n.address,value:a.stringWeiAmount,assetAddress:a.asset.address}]}})}async function _({wallet:s,tronApi:e,address:n,amount:a}){return(await j({tron:s.tron,tronApi:e,recipient:n,amount:new l({asset:a.asset,weiAmount:new C("1")})})).request.fee}async function F({recipient:s,amount:e,isMax:n,tronApi:a,wallet:i,balances:o}){if(n){const r=await _({wallet:i,tronApi:a,address:s.address,amount:e});e=new l({asset:e.asset,weiAmount:e.weiAmount.minus(r)})}const t=await j({tron:i.tron,tronApi:a,recipient:s.address,amount:e});if(t.internalMsgs.some(r=>r===!1))throw new Error("Estimation fail.");const d=o==null?void 0:o.balances.find(r=>r.token.address===t.request.feeToken);if(!d)throw new Error(`Unexpected feeToken, token's address is ${t.request.feeToken}`);return{fee:new l({asset:q(d),weiAmount:t.request.fee}),payload:t}}async function H({recipient:s,amount:e,isMax:n,api:a,wallet:i,jettons:o}){let t;if(e.asset.id===A.id)t=await J(a,i,s,e.weiAmount,n);else{const c=o.balances.find(r=>e.asset.address.toRawString()===r.jetton.address);t=await B(a,i,s,e,c.walletAddress.address)}return{fee:new l({asset:A,weiAmount:t.event.extra*-1}),payload:t}}function G(s,e,n){const{t:a}=T(),i=y(),{api:o}=m(),t=p(),d=h(),{data:c}=k(),{data:r}=N();return Q([K.estimate,s,e],async()=>{try{return E(e.asset)?await H({amount:e,api:o,wallet:t,recipient:s,isMax:n,jettons:c}):await F({amount:e,tronApi:o.tronApi,wallet:t,recipient:s,isMax:n,balances:r})}catch(f){throw await g(d,i,a,f),f}},{refetchInterval:x,refetchOnMount:"always"})}function V(s,e,n,a){const{t:i}=T(),o=y(),{api:t}=m(),d=p(),c=h(),r=M(),{data:f}=k(),{mutateAsync:b}=O();return R(async()=>{const w=await W(o,d.publicKey,b).catch(()=>null);if(w===null)return!1;try{if(E(e.asset))if(e.asset.id===A.id)r("send-ton"),await L(t,d,s,e,n,a.payload,w);else{r("send-jetton");const u=f.balances.find(I=>e.asset.address.toRawString()===I.jetton.address);await D(t,d,s,e,u.walletAddress.address,a.payload,w)}else throw new Error("Disable trc 20 transactions")}catch(u){await g(c,o,i,u)}return await c.invalidateQueries({predicate:u=>u.queryKey.includes(d.active.rawAddress)}),!0})}export{V as a,G as u};
